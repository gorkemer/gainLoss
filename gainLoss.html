
<!DOCTYPE html>
<html>
<head>
  <script src="../jspsych-6.0.5/jspsych.js"></script>
  <link rel="stylesheet" href="../jspsych-6.0.5/css/jspsych.css"></link>
  <script src="../jspsych-6.0.5/plugins/jspsych-html-button-response.js"></script>
  <script src="../jspsych-6.0.5/plugins/jspsych-image-button-response.js"></script>
  <script src="../jspsych-6.0.5/plugins/jspsych-image-keyboard-response.js"></script>
  <script src="../jspsych-6.0.5/plugins/jspsych-html-keyboard-response.js"></script>
    <script src="../jspsych-6.0.5/plugins/jspsych-instructions.js"></script>
</head>
<body></body>
<script>

var timeline = [];
var testStimuli = [];
var trial_pairsGain = []; 
var trial_pairsLoss = []; 

var instructions = {
  type: "instructions",
  pages: [ "<p> You'll need to select a shape and gain as many point as possible (gain task), </p>"+
    "<p> or avoid losing as many points as possible (loss task). </p>"
    ],
    show_clickable_nav:true
};

timeline.push(instructions);

var taskSwitchScreen = {
  type: "instructions",
  pages: ["<p> One of the task is over. Press 'next' to start the next task. </p>"],
  show_clickable_nav:true
};

// getting the subject condition variable from the url sent out the subjects
var participantID = jsPsych.data.getURLVariable('ParticipantID');
console.log('Participant ID is:', participantID);
if (typeof participantID === "undefined") {
alert("participant ID is undefined, assigning arbitrarily. ");
var participantID = 1;
}
jsPsych.data.addProperties({participant_ID: participantID});

//assigning conditions
if(participantID % 4 == 1){
partGroup =1;
}
else if(participantID % 4 == 2){
partGroup =2;
}
else if(participantID % 4 == 3){
partGroup =3;
}
else if(participantID % 4 == 0){
partGroup =4;
};

jsPsych.data.addProperties({part_group: partGroup}) // update the global variable
console.log('Group is defined as: ', partGroup);

//assigning order of the tasks


if (partGroup == 1){
  // #1 Win Pairs
var winPairUp_w = {stimulus: "<img src='img/stim1-omicron.png' width=46%>" + "<br>" + "<p> + </p>"+ "<img src='img/stim2-pi.png' width=46%>", pairType: "gain", pairOri: "a-up", win: true}
var winPairUp_n = {stimulus: "<img src='img/stim1-omicron.png' width=46%>" + "<br>" + "<p> + </p>"+ "<img src='img/stim2-pi.png' width=46%>", pairType: "gain", pairOri: "a-up", win: false}
var winPairDown_w = {stimulus: "<img src='img/stim2-pi.png' width=46%>" + "<br>" + "<p> + </p>"+ "<img src='img/stim1-omicron.png' width=46%>", pairType: "gain", pairOri: "a-down", win: true}
var winPairDown_n = {stimulus: "<img src='img/stim2-pi.png' width=46%>" + "<br>" + "<p> + </p>"+ "<img src='img/stim1-omicron.png' width=46%>", pairType: "gain", pairOri: "a-down", win: false}

// #2 Loss Pairs
var lossPairUp_l = {stimulus: "<img src='img/stim3-psi.png' width=46%>" + "<br>" + "<p> + </p>"+ "<img src='img/stim4-omega.png' width=46%>", pairType: "loss", pairOri: "a-up", win: true}
var lossPairUp_n = {stimulus: "<img src='img/stim3-psi.png' width=46%>" + "<br>" + "<p> + </p>"+ "<img src='img/stim4-omega.png' width=46%>", pairType: "loss", pairOri: "a-up", win: false}
var lossPairDown_l = {stimulus: "<img src='img/stim4-omega.png' width=46%>" + "<br>" + "<p> + </p>"+ "<img src='img/stim3-psi.png' width=46%>", pairType: "loss", pairOri: "a-down", win: true}
var lossPairDown_n = {stimulus: "<img src='img/stim4-omega.png' width=46%>" + "<br>" + "<p> + </p>"+ "<img src='img/stim3-psi.png' width=46%>", pairType: "loss", pairOri: "a-down", win: false}
console.log("partGroup should be 1:", partGroup)
} 

else if (partGroup == 2){
  // #1 Win Pairs
var winPairUp_w = {stimulus: "<img src='img/stim2-pi.png' width=46%>" + "<br>" + "<p> + </p>"+ "<img src='img/stim3-psi.png' width=46%>", pairType: "gain", pairOri: "a-up", win: true}
var winPairUp_n = {stimulus: "<img src='img/stim2-pi.png' width=46%>" + "<br>" + "<p> + </p>"+ "<img src='img/stim3-psi.png' width=46%>", pairType: "gain", pairOri: "a-up", win: false}
var winPairDown_w = {stimulus: "<img src='img/stim3-psi.png' width=46%>" + "<br>" + "<p> + </p>"+ "<img src='img/stim2-pi.png' width=46%>", pairType: "gain", pairOri: "a-down", win: true}
var winPairDown_n = {stimulus: "<img src='img/stim3-psi.png' width=46%>" + "<br>" + "<p> + </p>"+ "<img src='img/stim2-pi.png' width=46%>", pairType: "gain", pairOri: "a-down", win: false}

// #2 Loss Pairs
var lossPairUp_l = {stimulus: "<img src='img/stim4-omega.png' width=46%>" + "<br>" + "<p> + </p>"+ "<img src='img/stim1-omicron.png' width=46%>", pairType: "loss", pairOri: "a-up", win: true}
var lossPairUp_n = {stimulus: "<img src='img/stim4-omega.png' width=46%>" + "<br>" + "<p> + </p>"+ "<img src='img/stim1-omicron.png' width=46%>", pairType: "loss", pairOri: "a-up", win: false}
var lossPairDown_l = {stimulus: "<img src='img/stim1-omicron.png' width=46%>" + "<br>" + "<p> + </p>"+ "<img src='img/stim4-omega.png' width=46%>", pairType: "loss", pairOri: "a-down", win: true}
var lossPairDown_n = {stimulus: "<img src='img/stim1-omicron.png' width=46%>" + "<br>" + "<p> + </p>"+ "<img src='img/stim4-omega.png' width=46%>", pairType: "loss", pairOri: "a-down", win: false}
console.log("partGroup should be 2:", partGroup)
} 

else if (partGroup == 3){
  // #1 Win Pairs
var winPairUp_w = {stimulus: "<img src='img/stim3-psi.png' width=46%>" + "<br>" + "<p> + </p>"+ "<img src='img/stim4-omega.png' width=46%>", pairType: "gain", pairOri: "a-up", win: true}
var winPairUp_n = {stimulus: "<img src='img/stim3-psi.png' width=46%>" + "<br>" + "<p> + </p>"+ "<img src='img/stim4-omega.png' width=46%>", pairType: "gain", pairOri: "a-up", win: false}
var winPairDown_w = {stimulus: "<img src='img/stim4-omega.png' width=46%>" + "<br>" + "<p> + </p>"+ "<img src='img/stim3-psi.png' width=46%>", pairType: "gain", pairOri: "a-down", win: true}
var winPairDown_n = {stimulus: "<img src='img/stim4-omega.png' width=46%>" + "<br>" + "<p> + </p>"+ "<img src='img/stim3-psi.png' width=46%>", pairType: "gain", pairOri: "a-down", win: false}

// #2 Loss Pairs
var lossPairUp_l = {stimulus: "<img src='img/stim1-omicron.png' width=46%>" + "<br>" + "<p> + </p>"+ "<img src='img/stim2-pi.png' width=46%>", pairType: "loss", pairOri: "a-up", win: true}
var lossPairUp_n = {stimulus: "<img src='img/stim1-omicron.png' width=46%>" + "<br>" + "<p> + </p>"+ "<img src='img/stim2-pi.png' width=46%>", pairType: "loss", pairOri: "a-up", win: false}
var lossPairDown_l = {stimulus: "<img src='img/stim2-pi.png' width=46%>" + "<br>" + "<p> + </p>"+ "<img src='img/stim1-omicron.png' width=46%>", pairType: "loss", pairOri: "a-down", win: true}
var lossPairDown_n = {stimulus: "<img src='img/stim2-pi.png' width=46%>" + "<br>" + "<p> + </p>"+ "<img src='img/stim1-omicron.png' width=46%>", pairType: "loss", pairOri: "a-down", win: false}
console.log("partGroup should be 3:", partGroup)
} 

else if (partGroup == 4){
  // #1 Win Pairs
var winPairUp_w = {stimulus: "<img src='img/stim4-omega.png' width=46%>" + "<br>" + "<p> + </p>"+ "<img src='img/stim1-omicron.png' width=46%>", pairType: "gain", pairOri: "a-up", win: true}
var winPairUp_n = {stimulus: "<img src='img/stim4-omega.png' width=46%>" + "<br>" + "<p> + </p>"+ "<img src='img/stim1-omicron.png' width=46%>", pairType: "gain", pairOri: "a-up", win: false}
var winPairDown_w = {stimulus: "<img src='img/stim1-omicron.png' width=46%>" + "<br>" + "<p> + </p>"+ "<img src='img/stim4-omega.png' width=46%>", pairType: "gain", pairOri: "a-down", win: true}
var winPairDown_n = {stimulus: "<img src='img/stim1-omicron.png' width=46%>" + "<br>" + "<p> + </p>"+ "<img src='img/stim4-omega.png' width=46%>", pairType: "gain", pairOri: "a-down", win: false}

// #2 Loss Pairs
var lossPairUp_l = {stimulus: "<img src='img/stim2-pi.png' width=46%>" + "<br>" + "<p> + </p>"+ "<img src='img/stim3-psi.png' width=46%>", pairType: "loss", pairOri: "a-up", win: true}
var lossPairUp_n = {stimulus: "<img src='img/stim2-pi.png' width=46%>" + "<br>" + "<p> + </p>"+ "<img src='img/stim3-psi.png' width=46%>", pairType: "loss", pairOri: "a-up", win: false}
var lossPairDown_l = {stimulus: "<img src='img/stim3-psi.png' width=46%>" + "<br>" + "<p> + </p>"+ "<img src='img/stim2-pi.png' width=46%>", pairType: "loss", pairOri: "a-down", win: true}
var lossPairDown_n = {stimulus: "<img src='img/stim3-psi.png' width=46%>" + "<br>" + "<p> + </p>"+ "<img src='img/stim2-pi.png' width=46%>", pairType: "loss", pairOri: "a-down", win: false}

console.log("partGroup should be 4:", partGroup)
}

trial_pairsGain.push(
  winPairUp_w, 
  winPairUp_w, 
  winPairUp_w, 
  winPairUp_w, 
  winPairUp_n,
  winPairDown_w, 
  winPairDown_w, 
  winPairDown_w, 
  winPairDown_w,
  winPairDown_n,
  );

  //loss
trial_pairsLoss.push(
  lossPairUp_l,
  lossPairUp_l,
  lossPairUp_l,
  lossPairUp_l,
  lossPairUp_n,
  lossPairDown_l,
  lossPairDown_l,
  lossPairDown_l,
  lossPairDown_l,
  lossPairDown_n
  );

//randomizing the order of trials
var trial_pairsGain = jsPsych.randomization.repeat(trial_pairsGain, 3);
var trial_pairsLoss = jsPsych.randomization.repeat(trial_pairsLoss, 3);

var fixation = {
      type: 'html-keyboard-response',
      stimulus: '+',
      choices: jsPsych.NO_KEYS,
      trial_duration: 500
    };

var twoImagesGain = {
    type: 'html-keyboard-response',
    stimulus: jsPsych.timelineVariable('stimulus'),
    choices: ['y', 'h'],
    //trial_duration: 2000,
    data: {pair_type: jsPsych.timelineVariable('pairType'), pair_ori: jsPsych.timelineVariable('pairOri'), isItWin: jsPsych.timelineVariable('win')},
    //check what the response
    on_finish: function (data) {
      var responseGiven = jsPsych.data.get().last(1).values()[0].key_press;
      var pair_type = jsPsych.data.get().last(1).values()[0].pair_type;
      var pair_ori = jsPsych.data.get().last(1).values()[0].pair_ori;
      var win_type = jsPsych.data.get().last(1).values()[0].isItWin;
        // gain logic
      if (pair_type == "gain" && responseGiven == 89 && pair_ori == "a-up" && win_type == true) { //89 is y, 72 is h
        console.log('pair from gain; pressed y and ori was up and win is true')
        data.accuracy = 1
      } else if (pair_type == "gain" && responseGiven == 72 && pair_ori == "a-down" && win_type == true) {
        console.log('pair from gain; pressed h and ori was down and win is true') 
        data.accuracy = 1
        // loss logic
      } else {
        console.log('running else');
        console.log('responseGiven', responseGiven);
        console.log('pair_ori', pair_ori);
        console.log('isItWin', win_type);
        data.accuracy = 0
      }
    }
  }

var twoImagesLoss = {
    type: 'html-keyboard-response',
    stimulus: jsPsych.timelineVariable('stimulus'),
    choices: ['y', 'h'],
    trial_duration: 2000,
    data: {pair_type: jsPsych.timelineVariable('pairType'), pair_ori: jsPsych.timelineVariable('pairOri'), isItWin: jsPsych.timelineVariable('win')},
    //check what the response
    on_finish: function (data) {
      var responseGiven = jsPsych.data.get().last(1).values()[0].key_press;
      var pair_type = jsPsych.data.get().last(1).values()[0].pair_type;
      var pair_ori = jsPsych.data.get().last(1).values()[0].pair_ori;
      var win_type = jsPsych.data.get().last(1).values()[0].isItWin;
        // loss logic
      if (pair_type == "loss" && responseGiven == 89 && pair_ori == "a-up" && win_type == true) {
        console.log('pair from loss; pressed h and ori was down and win is true, (loss 1)') 
        data.accuracy = -1
      } else if (pair_type == "loss" && responseGiven == 72 && pair_ori == "a-down" && win_type == true) {
        console.log('pair from loss; pressed h and ori was down and win is true, (loss 1)') 
        data.accuracy = -1
      } else {
        console.log('running else');
        console.log('responseGiven', responseGiven);
        console.log('pair_ori', pair_ori);
        console.log('isItWin', win_type);
        data.accuracy = 0
      }
    }
  }

var responseFeedback = {
    type: "html-keyboard-response",
    stimulus: function () {
        var responseAccuracy = jsPsych.data.get().last(1).values()[0].accuracy; // get the data from two trials prior
          if (responseAccuracy == 1) {
            return "You gained 1!";
          } else if (responseAccuracy == -1) {
            return "You lost 1!";
          } else {
            return "You gain nothing!";
          }
      },
    trial_duration: 1000
};

var testProcedureGain = {
    timeline: [twoImagesGain,responseFeedback],
    timeline_variables: trial_pairsGain
};

var testProcedureLoss = {
    timeline: [twoImagesLoss,responseFeedback],
    timeline_variables: trial_pairsLoss
};

if(participantID % 8 == 5 || participantID % 8 == 6 || participantID % 8 == 7 || participantID % 8 == 0){
  timeline.push(testProcedureLoss, taskSwitchScreen, testProcedureGain)
  console.log ("loss task starts first")
  var gainFirst = false
} else {
timeline.push(testProcedureGain, taskSwitchScreen, testProcedureLoss)
var gainFirst = true
console.log ("gain task starts first")
}
jsPsych.data.addProperties({gain_first: gainFirst})

  jsPsych.init({
    timeline: timeline,
    on_finish: function() {
      jsPsych.data.displayData();
    }
  });

</script>
</html>